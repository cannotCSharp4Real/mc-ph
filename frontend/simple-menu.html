<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Menu - MC-PH Coffee Shop</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .product-card { border: 1px solid #ddd; padding: 20px; margin: 10px 0; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .sign-btn { background: #d4a574; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        .profile-dropdown { position: relative; }
        .cart-icon { background: #f0f0f0; padding: 10px; border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body>
    <header class="header">
        <h1>MC-PH Coffee Shop - Menu</h1>
        <div>
            <div class="cart-icon" id="cartIcon" style="display: none;">ðŸ›’ Cart (<span id="cartCount">0</span>)</div>
            <div class="profile-dropdown" id="profileDropdown" style="display: none;">
                ðŸ‘¤ Profile
                <div id="dropdownMenu" style="display: none;">
                    <a href="#" id="myProfile">My Profile</a>
                    <a href="#" id="myOrders">Orders</a>
                    <a href="#" id="logout">Logout</a>
                </div>
            </div>
            <button class="sign-btn" id="signBtn" style="display: none;">Sign In / Sign Up</button>
        </div>
    </header>

    <div id="productsContainer">
        <div>Loading products...</div>
    </div>

    <script>
        // Global variables
        let isAuthenticated = false;
        let currentUser = null;
        let allProducts = [];

        // Check authentication status
        function checkAuthStatus() {
            const token = localStorage.getItem('authToken');
            const userData = localStorage.getItem('userData');
            
            if (token && userData) {
                isAuthenticated = true;
                currentUser = JSON.parse(userData);
                console.log('User authenticated:', currentUser);
            } else {
                isAuthenticated = false;
                currentUser = null;
                console.log('User not authenticated');
            }
        }

        // Update header UI based on authentication
        function updateHeaderUI() {
            const cartIcon = document.getElementById('cartIcon');
            const profileDropdown = document.getElementById('profileDropdown');
            const signBtn = document.getElementById('signBtn');
            
            if (isAuthenticated && currentUser && currentUser.role === 'customer') {
                // Show cart and profile for authenticated customers
                cartIcon.style.display = 'block';
                profileDropdown.style.display = 'block';
                signBtn.style.display = 'none';
                console.log('Showing customer UI');
            } else {
                // Show sign in button for guests
                cartIcon.style.display = 'none';
                profileDropdown.style.display = 'none';
                signBtn.style.display = 'block';
                console.log('Showing guest UI');
            }
        }

        // Load products
        async function loadProducts() {
            try {
                console.log('Loading products...');
                const response = await fetch('/api/products');
                const products = await response.json();
                console.log('Products loaded:', products);
                
                allProducts = products;
                renderProducts();
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('productsContainer').innerHTML = '<div>Error loading products</div>';
            }
        }

        // Render products
        function renderProducts() {
            const container = document.getElementById('productsContainer');
            
            if (allProducts.length === 0) {
                container.innerHTML = '<div>No products found</div>';
                return;
            }

            container.innerHTML = allProducts.map(product => `
                <div class="product-card">
                    <h3>${product.name}</h3>
                    <p>${product.description}</p>
                    <p>Category: ${product.category}</p>
                    <p>Price: â‚±${product.price}</p>
                    <button onclick="addToCart('${product._id}')">Add to Cart</button>
                </div>
            `).join('');
        }

        // Add to cart function
        function addToCart(productId) {
            if (!isAuthenticated) {
                alert('Please sign in to add items to cart');
                return;
            }
            alert(`Added product ${productId} to cart!`);
        }

        // Event listeners
        document.getElementById('signBtn').addEventListener('click', function() {
            window.location.href = 'auth.html';
        });

        document.getElementById('logout').addEventListener('click', function() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('userData');
            window.location.reload();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing...');
            checkAuthStatus();
            updateHeaderUI();
            loadProducts();
        });
    </script>
</body>
</html>
